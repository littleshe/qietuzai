<!DOCTYPE html>
<html>
<head>
<title>切图仔</title>
<link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
<style>
#dropzone { border: 1px dashed #ccc; padding: 50px 0; text-align: center; border-radius: 5px }
.row { margin-top: 20px; }
.thumbnail{height:250px;overflow:hidden;background:#eee}
#footer{ text-align:center}
</style>
<script src="bower_components/jquery/dist/jquery.min.js"></script>
<script type="text/javascript" src="lib/psd.min.js"></script>
</head>
<body>
<div class="container"> 
  <!-- 拖拽 -->
  <div class="row">
    <div class="col-md-12">
      <p>感谢<a href="https://github.com/meltingice/psd.js">psd.js</a></p>
      <div id="dropzone">
        <h3>请拖个psd进来</h3>
      </div>
    </div>
  </div>
  <!-- 表单 -->
  <div class="row">
    <form class="col-md-12">
      <button class="btn btn-default btn-lg" type="button">导出所有图层</button>
      <!--<label style="margin-left:20px;">
        <input type="checkbox">
        包含@2x和@3x切图</label>-->
    </form>
  </div>
  <!-- 图层 -->
  <div class="row" id="layer"></div>
</div>
<script type="text/javascript">
  (function () {
    var PSD = require('psd');

    document.getElementById('dropzone').addEventListener('dragover', onDragOver, true);
    document.getElementById('dropzone').addEventListener('drop', onDrop, true);

    function onDragOver(e) {
      e.stopPropagation();
      e.preventDefault();
      e.dataTransfer.dropEffect = 'copy';
    }

    function onDrop(e) {
      e.stopPropagation();
      e.preventDefault();

      PSD.fromEvent(e).then(function (psd) {
		psd.tree().descendants().forEach(function (node) {
			if (node.isGroup()) return true;
			render(node)
		});
		
      });
    }
	
	function render(node){	
		var $item = $('<div class="col-xs-6 col-md-3"><a class="thumbnail"></a></div>')
		var $thumb = $item.find('.thumbnail')
		var $img = $(node.toPng())
		//$('<p>'+ node.name +'</p>').appendTo($thumb)
		$img.appendTo($thumb)
		$thumb.attr({
			'download': node.name,
			'href': $img.attr('src'),
			'target': '_blank'
		})
		$item.appendTo('#layer')
	}

  }());
  </script>
</body>
</html>
